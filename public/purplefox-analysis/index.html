<link rel=stylesheet href=../css/hyde.css><body><aside class=sidebar><div class="container sidebar-sticky"><div class=author-image><img src=../images/scarab.jpeg alt="Author Image" class=author-image></div><div class=sidebar-about><a href=https://pop-ecx.github.io/><h1>pop-ecx</h1></a><p class=lead>Break, Comprehend, Build</p></div><div class=social-links><a href=https://github.com/pop-ecx target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/github.svg width=24 height=24 alt=GitHub></a>
<a href=https://www.linkedin.com/in/oliver-mulwa target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/linkedin.svg width=24 height=24 alt=LinkedIn></a></div><nav><ul class=sidebar-nav><li><a href=https://pop-ecx.github.io/>Home</a></li><li><a href=../posts/>Posts</a></li><li><a href=../about/>About</a></li></ul></nav><p>&copy; 2025. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Purplefox Analysis</h1><time datetime=2025-02-25T11:03:11+0300 class=post-date>Tue, Feb 25, 2025</time><blockquote><p><em>Originally written Thu, Jun 15, 2023</em></p></blockquote><p><img src=https://pop-ecx.github.io/purplefox-analysis/images/dana-critchlow-BO5BswJwguI-unsplash.resized.resized.jpg alt="Photo by Dana Critchlow on Unsplash"></p><p>A couple of months ago, I came across an intriguing <code>.tmp</code> file that was sent to me. The sender mentioned that their antivirus software had flagged and caught the file on their computer. Naturally, I decided to investigate further. Although the file was labeled as a <code>.tmp</code> file, running it through a file utility revealed that it was actually an MSI (Microsoft Software Installer) file.</p><p>To delve deeper into the MSI file, I utilized a helpful utility called <code>msitools</code>. For more information on <code>msitools</code>, you can visit this <a href=https://wiki.gnome.org/msitools>link</a>. MSI files serve as installers for Windows programs, containing databases, actions, and sequences. Instead of providing an extensive explanation here, I recommend referring to this excellent resource to learn more about MSI files: <a href=https://www.cybereason.com/blog/threat-analysis-msi-masquerading-as-software-installer>Threat Analysis: MSI-Masquerading as Software Installer</a>.</p><p>Using the <code>msiinfo</code> tool, I examined all tables and streams within the installer. Here is an image showing the results:</p><p><img src=https://pop-ecx.github.io/purplefox-analysis/images/msiinfo.png alt="msiinfo results">
Next, I proceeded to extract the files for further analysis. I utilized <code>msidump</code> with the <code>-s</code> and <code>-t</code> options to dump the streams and tables, respectively.</p><p>With the files successfully dumped, I was able to inspect the <code>idt</code> files. It&rsquo;s worth noting that two folders are generated upon dumping the MSI file: &ldquo;binary&rdquo; and &ldquo;streams.&rdquo; Among these folders, the <code>customAction.idt</code> file caught my attention as it contained some VBS code.
<img src=https://pop-ecx.github.io/purplefox-analysis/images/customaction.png alt="customaction table"></p><p>Upon examining the VBS code, I discovered some interesting functionalities. The code creates a shell object using Wscript and adds a new policy and filters to block ports 135, 139, and 445 from being accessed. This initially seemed peculiar to me, but after conducting further research, I found that it was implemented to deter exploitation from rival threat actors, as explained in this article: <a href=https://www.akamai.com/blog/security/purple-fox-rootkit-now-propagates-as-a-worm>Purple Fox Rootkit Now Propagates as a Worm</a>.</p><p>Within the <code>binary</code> directory, two DLLs can be found. Here is an image displaying the contents:</p><p><img src=https://pop-ecx.github.io/purplefox-analysis/images/binary.png alt="dlls in binary directory">
In the <code>streams</code> directory, various files are present, including a <code>disk1.cab</code> file. By using <code>7z</code>, this file can be extracted to reveal additional files such as <code>winupdate64.log</code> and <code>winupdate32.log</code>.</p><p><img src=https://pop-ecx.github.io/purplefox-analysis/images/streams.png alt="results after extracting cab file"></p><p>Among these files, we see the two dlls found in the <code>binary</code> folder.</p><p>The <code>winupdate32</code> and <code>winupdate64</code> files are payloads designed for 32-bit and 64-bit Windows systems, respectively. Both of these PE files are packed with VmProtect. There&rsquo;s also sysupdate,log which contains an encrypted dll and rootkit.</p><p>For dynamic analysis, once the MSI file is executed, a window appears that installs either the 32-bit or 64-bit binaries.</p><p><img src=https://pop-ecx.github.io/purplefox-analysis/images/install.png alt="purple fox installation">
After the installation is complete, the machine is rebooted, installing Ms{8-random-characters}App.dll, which was encrypted in sysupdate.log file, in C:\windows\system32. This step ensures that a rootkit is present on the machine, thus ensuring persistence.<img src=https://pop-ecx.github.io/purplefox-analysis/images/bd.png alt="Bitdefender scan entry for purple fox"></p><p>Since I did not have access to Remnux or FLARE, I relied on tools such as VirusTotal, Intezer Analyze, and unpac.me to conduct a basic high-level analysis. To protect yourself from similar attacks, it is crucial to avoid using pirated software and to employ reliable antivirus or EDR solutions.</p><blockquote><p>md5 hash: e815a06c36238d3279791e6e17c4f332</p></blockquote></div></main></body></html>