<link rel=stylesheet href=/css/hyde.css><body><aside class=sidebar><div class="container sidebar-sticky"><div class=author-image><img src=/images/me.png alt="Author Image" class=author-image></div><div class=sidebar-about><a href=https://pop-ecx.github.io/><h1>pop-ecx</h1></a><p class=lead>Break, Comprehend, Build</p></div><div class=social-links><a href=https://github.com/pop-ecx target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/github.svg width=24 height=24 alt=GitHub></a>
<a href=https://keybase.io/oliver_m target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/keybase.svg width=24 height=24 alt=Keybase></a>
<a href=https://www.linkedin.com/in/oliver-mulwa target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/linkedin.svg width=24 height=24 alt=LinkedIn></a></div><nav><ul class=sidebar-nav><li><a href=https://pop-ecx.github.io/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/about/>About</a></li></ul></nav><p>&copy; 2025. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Clearfake 2: We now have Lumma</h1><time datetime=2025-04-09T12:11:34+0300 class=post-date>Wed, Apr 9, 2025</time><p>I had previously written about my cutting up of <a href=https://malpedia.caad.fkie.fraunhofer.de/details/js.clearfake>clearfake</a>
which you can find <a href=../clearfake/>here</a>.</p><p>Quick recap:</p><ul><li>We deobfuscated the powershell obtained from a fake browser update prompt.</li><li>The code executed base64 encoded command with window style hidden option.</li><li>The command downloaded a <code>data.zip</code> file.</li></ul><p>Now, the zip file is extracted, an exe is sought inside the contents and executed.
Here is the code responsible for that: <img src=extract-run.png alt=extract></p><p>The zip file contains 4 files:</p><ul><li>hv.exe: The executable that will be run.</li><li>iepdf32.dll: This is going to be loaded later.</li><li>rhombohedron.ai: Probably encrypted configs or payload.</li><li>shovelnose.deb: Photoshop color swatch.</li></ul><p>hv.exe seems benign according to virustotal. <img src=vt.png alt=vt></p><p>This is because the most important thing it does with respect
to the malware is to dynamically load the dll when run (dll sideloading).</p><p>When we look at the disassembly, we can see that it checks for that specific dll and errors when it is not found</p><p><img src=hv1.png alt=hv></p><p>If successful iepdf32.dll is loaded. What does it do? Firstly, a quick upload to VT now lights up as a christmas tree (I can&rsquo;t remember many products picking
it up a few months ago. I may be mistaken of course)</p><p><img src=iepdf32.png alt=iepdf32></p><p>This dll has the standard debugger detection capabilities by leveraging <code>IsDebuggerPresent</code>. The other 2 files, <code>shovelnose.deb</code> and <code>rhombohedron.ai</code>
are now called by this dll.</p><p><img src=rhom-ref.png alt="rhombohedron reference"></p><p><img src=shov-ref.png alt="shovelnose reference"></p><p>The dll seems to construct a path to rhombohedron file</p><p><img src=rhom-1.png alt="construct path"></p><p>After constructing the path to it, it opens the file using <code>CreateFileW</code> with a generic read.</p><p><img src=rhom-2.png alt="rhombohedron open"></p><p>Now the code reads <code>rhombohedron.ai</code> into memory and verifies if the read worked.</p><p><img src=rhom-3.png alt="Rhombohedron read into memory"></p><p>Entry point calculation is done and the payload is injected. Now the code is run directly from memory.</p><p>At this point the sample can be thrown into a sandbox and analyzed. Detonation shows it also reaches out to a couple
domains, which I assume are its C2.
Anyrun flags it correctly as Lumma</p><p><img src=anyrun.png alt="Lumma dynamic analysis"></p><p>Here is the infection chain</p><p><img src=anyrun2.png alt=infection></p><h1 id=iocs>IOCs</h1><p>parallelmercywksoffw[.]shop</p><p>landdumpycolorwskfw[.]shop</p><p>secretiveonnicuw[.]shop</p><p>notoriousdcellkw[.]shop</p><p>conferencefreckewl[.]shop</p><p>ohfantasyproclaiwlo[.]shop</p><p>barebrilliancedkoso[.]shop</p><p>liabiliytshareodlkv[.]shop</p><p>flourhishdiscovrw[.]shop</p><p><code>data.zip</code> ca2b787bb72f0bd9d79013aa93800bfd84c73aad74662c48e69425e4adfb549b</p><p><code>rhombohedron.ai</code> 67ff95298e395543ea0c9eeec6bfff81688df379bec578aa31c52d214b385180</p><p><code>shovelnose.deb</code> cc38b5cb522fdf8d2fe5e85c50d72e1b8ac39d36deb157d4bffdda7970c5ba8b</p></div></main></body></html>