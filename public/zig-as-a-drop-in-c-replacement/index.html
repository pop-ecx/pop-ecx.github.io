<link rel=stylesheet href=/css/hyde.css><body><aside class=sidebar><div class="container sidebar-sticky"><div class=author-image><img src=/images/me.png alt="Author Image" class=author-image></div><div class=sidebar-about><a href=https://pop-ecx.github.io/><h1>pop-ecx</h1></a><p class=lead>Tech musings</p></div><div class=social-links><a href=https://github.com/pop-ecx target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/github.svg width=24 height=24 alt=GitHub></a>
<a href=https://keybase.io/oliver_m target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/keybase.svg width=24 height=24 alt=Keybase></a>
<a href=https://bsky.app/profile/pop-ecx.bsky.social target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/bluesky.svg width=24 height=24 alt=Bluesky></a>
<a href=https://www.linkedin.com/in/oliver-mulwa target=_blank rel="noopener noreferrer"><img src=https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/linkedin.svg width=24 height=24 alt=LinkedIn></a></div><nav><ul class=sidebar-nav><li><a href=https://pop-ecx.github.io/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/about/>About</a></li></ul></nav><p>&copy; 2025. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Zig as a drop-in replacement for C build systems</h1><time datetime=2025-10-21T09:28:15+0300 class=post-date>Tue, Oct 21, 2025</time><p>A while back I wrote a small neofetch-like program in Zig as a way to learn the
language. I always knew Zig could interoperate with C, as I had earlier written
a yara rules parser using treesitter and Zig.</p><p>Now I wanted to test my neofetch-like program in various environments, and one
of those was st. St is a simple terminal emulator, part of the suckless
tools. It is written in C, minimalistic and I generally liked using it.</p><p>So, st uses a Makefile for building. In this case, I wanted to see if I could
entirely replace the Makefile with a Zig build file. I&rsquo;m kinda not used to Makefiles
and it can get complicated super quickly. Why not use Zig&rsquo;s build, something I&rsquo;m
more familiar with?</p><p>So this is how I did it.</p><p>The first step was to create a <code>build.zig</code> file in the st source directory.
I started by defining our build function with the necessary parameters:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>const</span> std <span style=color:#f92672>=</span> @import(<span style=color:#e6db74>&#34;std&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> build(b<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>std.Build) <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> target <span style=color:#f92672>=</span> b.standardTargetOptions(.{});
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> optimize <span style=color:#f92672>=</span> b.standardOptimizeOption(.{});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> exe_module <span style=color:#f92672>=</span> b.createModule(.{
</span></span><span style=display:flex><span>        .target <span style=color:#f92672>=</span> target,
</span></span><span style=display:flex><span>        .optimize <span style=color:#f92672>=</span> optimize,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> exe <span style=color:#f92672>=</span> b.addExecutable(.{
</span></span><span style=display:flex><span>	.name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;st&#34;</span>,
</span></span><span style=display:flex><span>	.root_module <span style=color:#f92672>=</span> exe_module,
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><p>Nothing special so far. Next, I needed to add the source files for st.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span>    exe.root_module.addCSourceFiles(.{
</span></span><span style=display:flex><span>        .files <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>.{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;st.c&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;x.c&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        .flags <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>.{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;-DVERSION=</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>0.9.3</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;-D_XOPEN_SOURCE=600&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;-I/usr/X11R6/include&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;-L/usr/X11R6/lib&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><p>This stage is important as it provides the C source files and the necessary flags
for compilation. The <code>-DVERSION</code> flag defines the version of st, while the
<code>-I</code> and <code>-L</code> specify the include and library paths for X11.</p><p>The next part is to bundle them together as below</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span>    exe.root_module.addCSourceFiles(.{
</span></span><span style=display:flex><span>        .files <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>.{},
</span></span><span style=display:flex><span>        .flags <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>.{},
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><p>The next step is to link against the X11 libraries that st depends on.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span>    exe.linkLibC();
</span></span><span style=display:flex><span>    exe.linkSystemLibrary(<span style=color:#e6db74>&#34;X11&#34;</span>);
</span></span><span style=display:flex><span>    exe.linkSystemLibrary(<span style=color:#e6db74>&#34;rt&#34;</span>);
</span></span><span style=display:flex><span>    exe.linkSystemLibrary(<span style=color:#e6db74>&#34;m&#34;</span>);
</span></span><span style=display:flex><span>    exe.linkSystemLibrary(<span style=color:#e6db74>&#34;util&#34;</span>);
</span></span><span style=display:flex><span>    exe.linkSystemLibrary(<span style=color:#e6db74>&#34;xft&#34;</span>);
</span></span><span style=display:flex><span>    exe.linkSystemLibrary(<span style=color:#e6db74>&#34;fontconfig&#34;</span>);
</span></span><span style=display:flex><span>    exe.linkSystemLibrary(<span style=color:#e6db74>&#34;freetype2&#34;</span>);
</span></span><span style=display:flex><span>    exe.addIncludePath(.{ 
</span></span><span style=display:flex><span>        .cwd_relative <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/usr/X11R6/include&#34;</span> 
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><blockquote><p>The more up-to-date way at the time of wtiting this is to use <code>root_module</code> e.g
<code>exe.root_module.link_libc = true;</code>.</p></blockquote><p>The <code>.cwd_relative</code> field is crucial since we are using absolute paths for the
include directories. Zig does complain about it though.</p><p>Next, <code>config.def.h</code> needs to be copied as it is specified in the Makefile.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span>    <span style=color:#66d9ef>const</span> config_copy <span style=color:#f92672>=</span> b.addSystemCommand(<span style=color:#f92672>&amp;</span>[_][]<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>u8</span>{ <span style=color:#e6db74>&#34;cp&#34;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;config.def.h&#34;</span>, <span style=color:#e6db74>&#34;config.h&#34;</span> });
</span></span><span style=display:flex><span>    exe.step.dependOn(<span style=color:#f92672>&amp;</span>config_copy.step);
</span></span></code></pre></div><p>Finally we can add a step for running the program after building it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span>    <span style=color:#66d9ef>const</span> run_cmd <span style=color:#f92672>=</span> b.addRunArtifact(exe);
</span></span><span style=display:flex><span>    run_cmd.step.dependOn(<span style=color:#f92672>&amp;</span>install_exe.step);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (b.args) <span style=color:#f92672>|</span>args<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>        run_cmd.addArgs(args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> run_step <span style=color:#f92672>=</span> b.step(<span style=color:#e6db74>&#34;run&#34;</span>, <span style=color:#e6db74>&#34;run the st terminal&#34;</span>);
</span></span><span style=display:flex><span>    run_step.dependOn(<span style=color:#f92672>&amp;</span>run_cmd.step);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>With all these pieces in place, the complete zig build file can be found in this
<a href=https://gist.github.com/pop-ecx/1b52d05cf2b38c075b0fbcce9f7157d9>Github gist</a>.</p><p>To build st using Zig, you would run the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>zig build
</span></span></code></pre></div><p>The resulting st binary should be created in the <code>zig-out/</code> directory.</p><video width=100% controls autoplay>
<source src=/videos/zig-builds-st.mp4 type=video/mp4>Your browser does not support the video tag.</video><p>Remember that this is a basic example and does not include all the features such
as install and uninstall in the original Makefile. That is left as an exercise
for the reader. You could try to build other C projects using Zig like Picom for example.</p><p>Anyway I kinda like the fact that I can build C projects with <del>Makefile</del>,
<del>C compiler</del>, just Zig.</p></div></main></body></html>